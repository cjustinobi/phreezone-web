(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{1055:function(t,e,r){"use strict";r(945)},1056:function(t,e,r){(e=r(45)(!1)).push([t.i,".user-ref[data-v-5bedf611]{margin-bottom:10px;margin-top:0;width:150px}",""]),t.exports=e},1102:function(t,e,r){"use strict";r.r(e);r(596),r(586),r(585),r(906),r(82),r(913),r(597),r(95);var n=r(27),o={name:"stream-upgrade-order",layout:"dashboard",data:function(){return{basePv:100,percentageRate:"",agentWallet:"",upgradeMember:"",loading:!1,editMode:!1,productForm:!1,productId:"",formItemLayout:{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}},formItemLayoutWithOutLabel:{wrapperCol:{xs:{span:24,offset:0},sm:{span:20,offset:4}}},dynamicValidateForm:{data:[{code:"",name:"",price:"",pv:"",qty:"",amount:"",subNormalAmount:"",subPv:"",subAmount:""}]},totalNormalOrder:"",totalOrder:"",totalPv:""}},methods:{submitForm:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.upgradeMember){e.next=2;break}return e.abrupt("return",t.$message.error("No member code entered"));case 2:if(!(t.agentBalance<=0)){e.next=4;break}return e.abrupt("return",t.$message.error("Insufficient amount in wallet"));case 4:if(t.validForm()){e.next=6;break}return e.abrupt("return",t.$message.error("All fields are required"));case 6:return t.loading=!0,e.next=9,t.$axios.$post("user/saveOrders",{soldBy:t.userId,boughtBy:t.upgradeMember.id,items:t.dynamicValidateForm.data,totalNormalAmount:t.totalNormalOrder,totalAmount:t.totalOrder,totalPv:t.totalPv});case 9:e.sent.success&&(t.resetForm(),t.$message.success("Added successfully"));case 11:case"end":return e.stop()}}),e)})))()},editProduct:function(t){this.item=t,this.productId=t.id,this.productForm=!0,this.editMode=!0},setCode:function(t){return t.name.length<=2?t.code="":(!t.code&&t.name.length>=3&&(t.code=t.name.substring(0,3).toUpperCase(),t.code+=Math.floor(100+900*Math.random())),t)},resetForm:function(){this.dynamicValidateForm.data=[{code:"",name:"",price:"",pv:"",qty:"",amount:"",subNormalAmount:"",subPv:"",subAmount:""}],this.getAgentWallet(),this.loading=!1,this.productForm=!1,this.editMode=!1,this.totalNormalOrder="",this.totalOrder="",this.totalPv="",this.upgradeMember=""},removeItem:function(t){var e=this.dynamicValidateForm.data.indexOf(t);-1!==e&&(this.dynamicValidateForm.data.splice(e,1),this.totalNormalOrder-=t.subNormalAmount,this.totalOrder-=t.subAmount,this.totalPv-=t.subPv)},addItem:function(){this.dynamicValidateForm.data.push({code:"",name:"",amount:"",price:"",pv:"",qty:"",subNormalAmount:"",subPv:"",subAmount:""})},setPv:function(t,e){t.price<this.basePv||(t.user_id=this.userId,t.code=this.setCode(t).code,t.pv=t.qty?(+t.price/this.basePv*this.percentageRate).toFixed(2)*+t.qty:(+t.price/this.basePv*this.percentageRate).toFixed(2),t.amount=t.qty?(+t.price+this.percentageRate*t.price)*+t.qty:+t.price+this.percentageRate*t.price,this.dynamicValidateForm.data[e]=t,this.setSubDetail(t,e))},setSubDetail:function(t,e){if(t.amount){if(t.subPv=+t.pv*+t.qty,t.subAmount=+t.amount*+t.qty,t.subNormalAmount=+t.price*+t.qty,this.totalNormalOrder=this.dynamicValidateForm.data.reduce((function(t,e){return(+t+ +e.subNormalAmount).toFixed(2)}),0),this.totalOrder=this.dynamicValidateForm.data.reduce((function(t,e){return(+t+ +e.subAmount).toFixed(2)}),0),this.totalPv=this.dynamicValidateForm.data.reduce((function(t,e){return(+t+ +e.subPv).toFixed(2)}),0),t.price<this.basePv)return;t.user_id=this.userId,t.code=this.setCode(t).code,t.pv=t.qty?(+t.price/this.basePv*this.percentageRate).toFixed(2)*+t.qty:(+t.price/this.basePv*this.percentageRate).toFixed(2),t.amount=t.qty?(+t.price+this.percentageRate*t.price)*+t.qty:+t.price+this.percentageRate*t.price,this.dynamicValidateForm.data[e]=t}},validForm:function(){return this.dynamicValidateForm.data.every((function(i){return Object.values(i).every((function(t){return t}))}))},getAgentWallet:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$axios.$get("admin/agentWallet/".concat(t.userId));case 2:t.agentWallet=e.sent.data;case 3:case"end":return e.stop()}}),e)})))()},getMember:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.$post("user/null",{userReferral:t.userReferral});case 3:t.upgradeMember=e.sent.data,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),t.$message.error("Invalid Referral code entered");case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))()},getPercentageRate:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$axios.$get("admin/percentageRate");case 2:t.percentageRate=e.sent.data;case 3:case"end":return e.stop()}}),e)})))()}},computed:{agentBalance:function(){return this.agentWallet-this.totalOrder},noBalance:function(){return this.agentBalance<=0}},beforeMount:function(){this.getPercentageRate(),this.getAgentWallet(),this.isStockist||this.$router.push("/home"),this.$route.params.ref&&(this.userReferral=this.$route.params.ref,this.getMember())},watch:{totalOrder:{handler:function(t){if(t){var e=this.agentWallet-this.totalOrder;return this.agentBalance=e>=0?t:0}}}}},c=(r(1055),r(34)),component=Object(c.a)(o,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("a-page-header",{attrs:{"sub-title":"Products"}},[r("template",{slot:"extra"},[r("span",[r("b",[t._v("Product Order")])]),r("br"),t._v(" "),r("span",{staticStyle:{margin:"0"}},[t._v("Total Order Amount: "),r("b",[t._v(t._s(t.totalOrder))])]),r("br"),t._v(" "),r("span",{staticStyle:{margin:"0"}},[t._v("Total PV: "),r("b",[t._v(t._s(t.totalPv))])])])],2),t._v(" "),t.agentWallet?r("h5",[r("span",{staticStyle:{color:"grey","margin-bottom":"0"}},[t._v("\n    Available Amount: ")]),t._v(t._s(t._f("currency")(t.agentBalance))+"\n  ")]):r("h5",[t._v("Available Amount: NGN 0.00")]),t._v(" "),r("br"),t._v(" "),t.upgradeMember?r("h6",[t._v(t._s(t.upgradeMember.full_name))]):t._e(),t._v(" "),r("a-input",{staticClass:"user-ref",attrs:{placeholder:"Member code"},on:{blur:t.getMember},model:{value:t.userReferral,callback:function(e){t.userReferral=e},expression:"userReferral"}}),t._v(" "),r("a-form-model",t._b({ref:"dynamicValidateForm",attrs:{model:t.dynamicValidateForm}},"a-form-model",t.formItemLayoutWithOutLabel,!1),[t._l(t.dynamicValidateForm.data,(function(e,n){return r("a-form-model-item",t._b({key:n,attrs:{label:0===n?"Items to Purchase":"",prop:"data."+n+".item",rules:{required:!0,message:"Field is empty",trigger:"blur"}}},"a-form-model-item",0===n?t.formItemLayout:{},!1),[r("a-row",{attrs:{gutter:"2"}},[r("a-col",{attrs:{xs:23}},[r("a-input",{staticStyle:{"margin-right":"8px"},attrs:{placeholder:"Enter Product name"},model:{value:e.name,callback:function(r){t.$set(e,"name",r)},expression:"item.name"}})],1),t._v(" "),r("a-col",{attrs:{xs:1}},[t.dynamicValidateForm.data.length>1?r("a-icon",{staticClass:"dynamic-delete-button",attrs:{type:"minus-circle-o",disabled:1===t.dynamicValidateForm.data.length},on:{click:function(r){return t.removeItem(e)}}}):t._e()],1)],1),t._v(" "),r("a-row",{attrs:{gutter:"2"}},[r("a-col",{attrs:{xs:10}},[r("a-input",{staticStyle:{"margin-right":"8px"},attrs:{type:"number",placeholder:"Amount"},on:{change:function(r){return t.setPv(e,n)}},model:{value:e.price,callback:function(r){t.$set(e,"price",r)},expression:"item.price"}})],1),t._v(" "),r("a-col",{attrs:{xs:4}},[r("a-input",{staticStyle:{"margin-right":"8px"},attrs:{disabled:"",placeholder:"PV"},model:{value:e.pv,callback:function(r){t.$set(e,"pv",r)},expression:"item.pv"}})],1),t._v(" "),r("a-col",{attrs:{xs:10}},[r("a-input",{staticStyle:{"margin-right":"8px"},attrs:{disabled:"",placeholder:"Actual Amount"},model:{value:e.amount,callback:function(r){t.$set(e,"amount",r)},expression:"item.amount"}})],1)],1),t._v(" "),r("a-row",{attrs:{gutter:"2"}},[r("a-col",{attrs:{xs:10}},[r("a-input",{staticStyle:{"margin-right":"8px"},attrs:{min:"1",type:"number",placeholder:"Quantity"},on:{change:function(r){return t.setSubDetail(e,n)}},model:{value:e.qty,callback:function(r){t.$set(e,"qty",r)},expression:"item.qty"}})],1)],1)],1)})),t._v(" "),r("a-form-model-item",t._b({},"a-form-model-item",t.formItemLayoutWithOutLabel,!1),[r("a-button",{attrs:{disabled:t.noBalance,type:"dashed"},on:{click:t.addItem}},[r("a-icon",{attrs:{type:"plus"}}),t._v(" Add field")],1)],1),t._v(" "),t.dynamicValidateForm.data.length?r("a-form-model-item",t._b({},"a-form-model-item",t.formItemLayoutWithOutLabel,!1),[r("a-button",{attrs:{type:"primary",disabled:t.noBalance,loading:t.loading,"html-type":"submit"},on:{click:function(e){return t.submitForm()}}},[t._v("\n          Submit\n        ")])],1):t._e()],2)],1)}),[],!1,null,"5bedf611",null);e.default=component.exports},906:function(t,e,r){"use strict";var n=r(28),o=r(306),c=r(165),l=r(62),d=r(97),m=r(307),f=r(184),h=r(185),v=r(96),y=h("splice"),x=v("splice",{ACCESSORS:!0,0:0,1:2}),_=Math.max,F=Math.min;n({target:"Array",proto:!0,forced:!y||!x},{splice:function(t,e){var r,n,h,v,y,x,P=d(this),A=l(P.length),R=o(t,A),O=arguments.length;if(0===O?r=n=0:1===O?(r=0,n=A-R):(r=O-2,n=F(_(c(e),0),A-R)),A+r-n>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(h=m(P,n),v=0;v<n;v++)(y=R+v)in P&&f(h,v,P[y]);if(h.length=n,r<n){for(v=R;v<A-n;v++)x=v+r,(y=v+n)in P?P[x]=P[y]:delete P[x];for(v=A;v>A-n+r;v--)delete P[v-1]}else if(r>n)for(v=A-n;v>R;v--)x=v+r-1,(y=v+n-1)in P?P[x]=P[y]:delete P[x];for(v=0;v<r;v++)P[v+R]=arguments[v+2];return P.length=A-n+r,h}})},913:function(t,e,r){"use strict";var n=r(28),o=r(165),c=r(914),l=r(590),d=r(38),m=1..toFixed,f=Math.floor,h=function(t,e,r){return 0===e?r:e%2==1?h(t,e-1,r*t):h(t*t,e/2,r)};n({target:"Number",proto:!0,forced:m&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!d((function(){m.call({})}))},{toFixed:function(t){var e,r,n,d,m=c(this),v=o(t),data=[0,0,0,0,0,0],y="",x="0",_=function(t,e){for(var r=-1,n=e;++r<6;)n+=t*data[r],data[r]=n%1e7,n=f(n/1e7)},F=function(t){for(var e=6,r=0;--e>=0;)r+=data[e],data[e]=f(r/t),r=r%t*1e7},P=function(){for(var t=6,s="";--t>=0;)if(""!==s||0===t||0!==data[t]){var e=String(data[t]);s=""===s?e:s+l.call("0",7-e.length)+e}return s};if(v<0||v>20)throw RangeError("Incorrect fraction digits");if(m!=m)return"NaN";if(m<=-1e21||m>=1e21)return String(m);if(m<0&&(y="-",m=-m),m>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(m*h(2,69,1))-69)<0?m*h(2,-e,1):m/h(2,e,1),r*=4503599627370496,(e=52-e)>0){for(_(0,r),n=v;n>=7;)_(1e7,0),n-=7;for(_(h(10,n,1),0),n=e-1;n>=23;)F(1<<23),n-=23;F(1<<n),_(1,1),F(2),x=P()}else _(0,r),_(1<<-e,0),x=P()+l.call("0",v);return x=v>0?y+((d=x.length)<=v?"0."+l.call("0",v-d)+x:x.slice(0,d-v)+"."+x.slice(d-v)):y+x}})},914:function(t,e,r){var n=r(140);t.exports=function(t){if("number"!=typeof t&&"Number"!=n(t))throw TypeError("Incorrect invocation");return+t}},945:function(t,e,r){var content=r(1056);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(46).default)("9083f672",content,!0,{sourceMap:!1})}}]);